<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Why Check for null?</title>
  <meta name="description" content="Intro">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="objectivetruth.github.io/tutorial/2014/07/28/why-check-for-null.html">
  <link rel="alternate" type="application/rss+xml" title="Nothing but the Objectivetruth" href="objectivetruth.github.io/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Nothing but the Objectivetruth</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Why Check for null?</h1>
    <p class="post-meta">Jul 28, 2014</p>
  </header>

  <article class="post-content">
    <h2>Intro</h2>

<p>I&#39;m fairly active over at r/androiddev and someone asked about why check for null? </p>

<p>I remember asking the same questions when I first started but after a
while it just becomes part of your every day routine with android, check
out how and when to check for null</p>

<p>I&#39;ve seen a common complain between the android and iPhone dev community
that iPhone you don&#39;t have to check for null, when you need or reference
something that you except it always returns it (guaranteed apparently).</p>

<p>On android, the system is much more complex and with increase complexity
means more points of failure.</p>

<p>(shout out to crunchify for the featured image)</p>

<h2>Why check for null in the first place?</h2>

<p>Bottom line, checking for null avoids unsightly NPE(null pointer
exceptions) when your user does something you never expected or even the
system didn&#39;t expect would ever happen.</p>

<p>In the reddit comment I answered, the example was using Google&#39;s AdMob
with an adView. Below is the sample code, the question and my response:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">gms</span><span class="o">.</span><span class="na">ads</span><span class="o">.</span><span class="na">banner</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.google.android.gms.ads.AdRequest</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.google.android.gms.ads.AdSize</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">com.google.android.gms.ads.AdView</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
    <span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>
    <span class="cm">/**</span>
<span class="cm">     * A simple {@link Activity} that embeds an AdView.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">BannerSample</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
      <span class="cm">/** The view to show the ad. */</span>
      <span class="kd">private</span> <span class="n">AdView</span> <span class="n">adView</span><span class="o">;</span>
      <span class="cm">/* Your ad unit id. Replace with your actual ad unit id. */</span>
      <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">AD_UNIT_ID</span> <span class="o">=</span> <span class="s">&quot;INSERT_YOUR_AD_UNIT_ID_HERE&quot;</span><span class="o">;</span>
      <span class="cm">/** Called when the activity is first created. */</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
        <span class="c1">// Create an ad.</span>
        <span class="n">adView</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AdView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="n">adView</span><span class="o">.</span><span class="na">setAdSize</span><span class="o">(</span><span class="n">AdSize</span><span class="o">.</span><span class="na">BANNER</span><span class="o">);</span>
        <span class="n">adView</span><span class="o">.</span><span class="na">setAdUnitId</span><span class="o">(</span><span class="n">AD_UNIT_ID</span><span class="o">);</span>
        <span class="c1">// Add the AdView to the view hierarchy. The view will have no size</span>
        <span class="c1">// until the ad is loaded.</span>
        <span class="n">LinearLayout</span> <span class="n">layout</span> <span class="o">=</span> <span class="o">(</span><span class="n">LinearLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">linearLayout</span><span class="o">);</span>
        <span class="n">layout</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">adView</span><span class="o">);</span>
        <span class="c1">// Create an ad request. Check logcat output for the hashed device ID to</span>
        <span class="c1">// get test ads on a physical device.</span>
        <span class="n">AdRequest</span> <span class="n">adRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AdRequest</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">addTestDevice</span><span class="o">(</span><span class="n">AdRequest</span><span class="o">.</span><span class="na">DEVICE_ID_EMULATOR</span><span class="o">)</span>
            <span class="o">.</span><span class="na">addTestDevice</span><span class="o">(</span><span class="s">&quot;INSERT_YOUR_HASHED_DEVICE_ID_HERE&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="c1">// Start loading the ad in the background.</span>
        <span class="n">adView</span><span class="o">.</span><span class="na">loadAd</span><span class="o">(</span><span class="n">adRequest</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">adView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">adView</span><span class="o">.</span><span class="na">resume</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">adView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">adView</span><span class="o">.</span><span class="na">pause</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="cm">/** Called before the activity is destroyed. */</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Destroy the AdView.</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">adView</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">adView</span><span class="o">.</span><span class="na">destroy</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onDestroy</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div>
<h2>The question</h2>

<p>I am curious why are you doing <code>if (adView !=null) adView.destory();</code> and likewise for all activity calls. I have seen that before. 
I checked Android reference on <code>AdView</code> and it just calls <code>mAdView.pause();</code>, <code>mAdView.destroy();</code>, etc.</p>

<h2>My response:</h2>

<p>This is just good practice. Its a common complaint with android that even though you think something will NEVER, ever, EVER! be null.. there will be some fringe case where it will be null and the user will get an unsightly crash (wop wonnn...)</p>

<p>You should especially do this when you&#39;re working with Views, or activities, or well lots of things. Lets say there&#39;s a moment when an activity is queued to be destroyed and the add is still loading, and the ad(being a good citizen) takes it upon itself to self destruct.</p>

<p>By the time the onDestroy gets called, your adView no longer exists. So when adView.destroy() gets called, you&#39;ll get a NPE(null pointer exception).</p>

<p>When I first started I didn&#39;t understand it either, but the more you do live apps you&#39;ll get these very strange NPEs that can be avoided by checking for null.</p>

<h2>When and where to check for nulls?</h2>

<p>I&#39;ve come to the conclusion that you should check whenever you receive a reference for something you did NOT control, is transient(can be destroyed at any time),  or is not a system Singleton. Examples of places you must check for null (not exhaustive list):</p>

<ul>
<li><p>Views</p></li>
<li><p>Activities</p></li>
<li><p>Fragments</p></li>
<li><p>Strings</p></li>
<li><p>Intents Bundles</p></li>
</ul>

<p>Something important to note is when referencing an activity from within a listener. This you have to be very careful with.. are you sure it has to be there?</p>

<h3>Can the activity be destroyed before the listener has been called or destroyed?</h3>

<p>Examples of where not to check for nulls:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">AppWidgetManager</span><span class="o">.</span><span class="na">getInstance</span><span class="o">()&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">ALARM_SERVICE</span><span class="o">)</span>
<span class="n">PreferenceManager</span><span class="o">.</span><span class="na">getDefaultSharedPreferences</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</code></pre></div>
<p>The list of what not to check is fairly large but you can get the idea, a system service is something the system controls and there is always at LEAST 1 of them.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Nothing but the Objectivetruth</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Nothing but the Objectivetruth</li>
          <li><a href="mailto:miguel@objectivetruth.ca">miguel@objectivetruth.ca</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/Objectivetruth">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">Objectivetruth</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Musing from a mature student with a background in Sales, Biosciences and now Computer Science. Trying to save the world one app at a time.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
